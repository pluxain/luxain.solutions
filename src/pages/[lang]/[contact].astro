---
import type { GetStaticPaths } from "astro";
import BaseLayout from "@layouts/BaseLayout.astro";
import * as m from "@messages/messages";
import { availableLanguageTags } from "@messages/runtime";

const pageTitle = m.contact_title();
const description = m.contact_description();

export const getStaticPaths = (async () => {
  return availableLanguageTags.map((lang) => ({
    params: { lang, contact: m.contact_slug(undefined, { languageTag: lang }) },
  }));
}) satisfies GetStaticPaths;
---

<BaseLayout description={description} pageTitle={pageTitle}>
  <section class="flex w-full grow flex-col justify-center md:m-auto md:w-96">
    <h1
      class="py-10 text-center text-3xl font-bold [font-variant-caps:small-caps]"
    >
      {pageTitle}
    </h1>
    <form novalidate class="flex flex-col gap-4">
      <fieldset class="flex flex-col gap-4">
        <div class="flex flex-col gap-2">
          <label for="from" class="font-bold">
            {m.contact_form_label_from()} *
          </label>
          <input
            type="email"
            name="from"
            id="from"
            required
            class="grow border-b pb-1 outline-none focus:border-b-2 focus:border-primary"
          />
        </div>
        <div class="flex flex-col gap-2">
          <label for="subject" class="font-bold">
            {m.contact_form_label_subject()} *
          </label>
          <input
            type="text"
            name="subject"
            id="subject"
            required
            class="grow border-b pb-1 outline-none focus:border-b-2 focus:border-primary"
          />
        </div>
        <div class="flex flex-col gap-2">
          <label for="message" class="font-bold">
            {m.contact_form_label_message()} *
          </label>
          <textarea
            name="message"
            id="message"
            required
            class="h-32 grow resize-y border-b py-1 outline-none focus:border-b-2 focus:border-primary"
          ></textarea>
        </div>
      </fieldset>
      <fieldset class="flex flex-row justify-end">
        <button
          type="submit"
          class="grow bg-primary-flip px-4 py-2 text-primary-flip hover:bg-success-flip hover:text-success-flip"
        >
          {m.contact_form_submit()}
        </button>
      </fieldset>
      <dl class="flex gap-2">
        <dt class="font-bold">*:</dt><dd>{m.field_required()}</dd>
      </dl>
    </form>
  </section>
</BaseLayout>

<script>
  const urlSearchParams = new URLSearchParams(window.location.search);
  const subject = urlSearchParams.get("subject");
  const i = document.getElementById("subject") as HTMLInputElement;
  if (i && subject) {
    i.value = subject;
  }
</script>

<script>
  import { actions } from "astro:actions";

  const form = document.querySelector("form");
  form?.addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    const { data, error } = await actions.mail.send(formData);
    if (error) {
      // eslint-disable-next-line no-console
      console.error(error);
      return;
    }
    // eslint-disable-next-line no-console
    console.log(data);
  });
</script>
